<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="utf-8">
  <meta content="width=device-width, initial-scale=1.0" name="viewport">

  <title>NetBreakers - Formulario</title>
  <meta content="" name="description">
  <meta content="" name="keywords">

  <!-- Favicons -->
  <link href="/img/favicon.png" rel="icon">
  <link href="/img/apple-touch-icon.png" rel="apple-touch-icon">

  <!-- Google Fonts -->
  <link
          href="https://fonts.googleapis.com/css?family=Open+Sans:300,300i,400,400i,600,600i,700,700i|Jost:300,300i,400,400i,500,500i,600,600i,700,700i|Poppins:300,300i,400,400i,500,500i,600,600i,700,700i"
          rel="stylesheet">

  <!-- Vendor CSS Files -->
  <link href="/vendor/bootstrap/css/bootstrap.min.css" rel="stylesheet">
  <link href="/vendor/icofont/icofont.min.css" rel="stylesheet">
  <link href="/vendor/boxicons/css/boxicons.min.css" rel="stylesheet">
  <link href="/vendor/remixicon/remixicon.css" rel="stylesheet">
  <link href="/vendor/venobox/venobox.css" rel="stylesheet">
  <link href="/vendor/owl.carousel//owl.carousel.min.css" rel="stylesheet">
  <link href="/vendor/aos/aos.css" rel="stylesheet">

  <!-- Icons font CSS - Formulario-->
  <link href="vendor/mdi-font/css/material-design-iconic-font.min.css" rel="stylesheet" media="all">
  <link href="vendor/font-awesome-4.7/css/font-awesome.min.css" rel="stylesheet" media="all">
  <!-- Font special for pages Formulario -->
  <link href="https://fonts.googleapis.com/css?family=Open+Sans:300,300i,400,400i,600,600i,700,700i,800,800i"
        rel="stylesheet">

  <!-- Vendor CSS Formulario -->
  <link href="vendor/select2/select2.min.css" rel="stylesheet" media="all">
  <link href="vendor/datepicker/daterangepicker.css" rel="stylesheet" media="all">

  <!-- Template Main CSS File -->
  <link href="/css/style.css" rel="stylesheet">

</head>

<body>

<!-- ======= Header ======= -->
<header id="header" class="fixed-top " style="background-color: #a71d2a">
  <div class="container d-flex align-items-center">

    <h1 class="logo mr-auto"><a href="/create-form/">NetBreakers</a></h1>

    <nav class="nav-menu d-none d-lg-block">
      <ul>
        <li><a href="/create-form/">Formulario</a></li>
        <li class="active" ><a href="/list-form/">Listar Formularios</a></li>
      </ul>
    </nav><!-- .nav-menu -->

    <a href="/" class="get-started-btn scrollto">Cerrar Sesión</a>

  </div>
</header><!-- End Header -->

<!-- ======= Hero Section ======= -->
<section id="hero" class="d-flex align-items-center" style="background-color: #a71d2a">

  <div class="container">
    <div class="row">
      <div class="col-lg-6 d-flex flex-column justify-content-center pt-4 pt-lg-0 order-2 order-lg-1"
           data-aos="fade-up" data-aos-delay="200">
        <h1>Listar Formularios (Cliente REST)</h1>
        <h2>Somos un equipo de analistas e ingenieros de los datos que aplican el método científico a los
          resultados
          de tus encuesta</h2>
      </div>
      <div class="col-lg-6 order-1 order-lg-2 hero-img" data-aos="zoom-in" data-aos-delay="200">
        <img src="/img/hero-img.png" class="img-fluid animated" alt="">
      </div>
    </div>
  </div>

</section><!-- End Hero -->

<main id="main">
  <br>
  <div class="container justify-content-center">
    <!-- <a id="btnSync" href="" class="btn btn-sm btn-primary">Sincronizar con servidor</a> -->

    <button type="button" class="btn btn-primary" data-toggle="modal" data-target="#exampleModalSync">
      Buscar Formularios
    </button>

    <!-- Modal -->
    <div class="modal fade" id="exampleModalSync" tabindex="-1" role="dialog" aria-labelledby="exampleModalLabelSync" aria-hidden="true">
      <div class="modal-dialog" role="document">
        <div class="modal-content">
          <div class="modal-header">
            <h5 class="modal-title" id="exampleModalLabelSync">Filtrar Formularios</h5>
            <button type="button" class="close" data-dismiss="modal" aria-label="Close">
              <span aria-hidden="true">&times;</span>
            </button>
          </div>
          <div class="modal-body">
            <input class="input--style-5" id="username" name="username">
          </div>
          <div class="modal-footer">
            <button type="button" class="btn btn-secondary" data-dismiss="modal">Cancelar</button>
            <button id="btnSync" type="button" class="btn btn-success" onclick="searchForm()">Aceptar</button>
          </div>
        </div>
      </div>
    </div>


    <br>
    <br>
    <table class="table table-striped table-responsive" id="tableForms">
      <thead>
      <tr>
        <th scope="col">Nombre</th>
        <th scope="col">Apellido</th>
        <th scope="col">Sector</th>
        <th scope="col">Nivel escolar</th>
        <th scope="col">Usuario</th>
        <th scope="col">Foto</th>
        <th scope="col">Acción 1</th>
      </tr>
      </thead>
      <tbody id="bodyForms">
      </tbody>
    </table>
  </div>

  <div class="container" data-aos="fade-up">

    <div class="section-title">
      <h2>Mapa</h2>
    </div>

    <div class="col-lg-5 ">

      <iframe src="https://maps.google.com/maps?q=0, 0&z=15&output=embed" frameborder="0"
              style="border:0; width: 100%; height: 290px;" allowfullscreen id="map"></iframe>
    </div>


  </div>

</main><!-- End #main -->

<br>

<!-- ======= Footer ======= -->
<footer id="footer" style="background-color: #a71d2a">

  <div class="container footer-bottom clearfix">
    <div class="copyright">
      &copy; Copyright <strong><span>NetBreakers</span></strong>. Todos los derechos reservados 2021
    </div>
    <div class="credits">
      <!-- All the links in the footer should remain intact. -->
      <!-- You can delete the links only if you purchased the pro version. -->
      <!-- Licensing information: https://bootstrapmade.com/license/ -->
      <!-- Purchase the pro version with working PHP/AJAX contact form: https://bootstrapmade.com/arsha-free-bootstrap-html-template-corporate/ -->
      Diseñado por Víctor Gómez y José Rafael
    </div>
  </div>
</footer><!-- End Footer -->

<a href="#" class="back-to-top"><i class="ri-arrow-up-line"></i></a>
<div id="preloader"></div>

<div class="center">
  <div class="modal show-modal" id="exampleModal" tabindex="-1" role="dialog" aria-labelledby="exampleModalLabel"
       aria-hidden="true">
    <div class="modal-dialog" role="document">
      <div class="modal-content">
        <div class="modal-header">
          <h5 class="modal-title" id="exampleModalLabel">Foto</h5>
          <button id="close2" type="button" class="close" data-dismiss="modal" aria-label="Close">
            <span aria-hidden="true">&times;</span>
          </button>
        </div>
        <div class="modal-body">
          <img id="imgtest" src="" alt="">
        </div>
        <div class="modal-footer">
          <button id="close" type="button" class="btn btn-secondary" data-dismiss="modal">Cerrar</button>
        </div>
      </div>
    </div>
  </div>
</div>


<!-- Vendor JS Files -->
<script src="/vendor/jquery/jquery.min.js"></script>
<script src="/vendor/bootstrap/js/bootstrap.bundle.min.js"></script>
<script src="/vendor/jquery.easing/jquery.easing.min.js"></script>
<script src="/vendor/php-email-form/validate.js"></script>
<script src="/vendor/waypoints/jquery.waypoints.min.js"></script>
<script src="/vendor/isotope-layout/isotope.pkgd.min.js"></script>
<script src="/vendor/venobox/venobox.min.js"></script>
<script src="/vendor/owl.carousel/owl.carousel.min.js"></script>
<script src="/vendor/aos/aos.js"></script>

<!-- Template Main JS File -->
<script src="/js/main.js"></script>
<script src="https://unpkg.com/dexie@latest/dist/dexie.js"></script>

<script>
    function showMap(name) {
      let arr = document.getElementsByName(name);
      let latitude = arr[0].value;
      let longitud = arr[1].value;

      console.log(arr);
      console.log(latitude);
      console.log(longitud);

      document.getElementById("map").src = "https://maps.google.com/maps?q=" + latitude + ", " +
              longitud +
              "&z=15&output=embed";
    }

  function listForms() {
    let forms;
    let user = document.getElementById("username").value;
    let url = 'http://localhost:7000/api/v1/form/'+user;
    const token = localStorage.getItem('token');


    fetch(url, {
      method: 'GET',
      headers:{
        'Content-Type': 'application/json',
        mode: 'no-cors',
        'Authorization': 'Bearer '+token
      }

    }).then(res => res.json())
            .catch(error => { console.error('Error:', error); })
            .then(response => {
              console.log(response);
              if(response != undefined){
                forms = response;
                fillTable(forms);
                alert("La busqueda ha sido exitosa.");
              }

            });

  }


  function fillTable(forms) {

    const body = document.getElementById("bodyForms");

    forms.forEach((form, index) => {

      const tr = document.createElement('tr');
      let tds = '';

      tds += `
                        <td>${form.name}</td>
                        <td>${form.lastName}</td>
                        <td>${form.area}</td>
                        <td>${form.nivelEscolar}</td>
                        <td>${form.user}</td>
                        <td><button id="btnPhoto-${index}" class="btn btn-success btn-sm">Foto</button></td>
                        <td><button id="btnMap-${index}" class="btn btn-primary btn-sm">Mapa</button></td>
                        <input type="hidden" value="${index}">
                        <input name=${index} type="hidden" value="${form.latitude}">
                        <input name=${index} type="hidden" value="${form.longitude}">
                    `

      tr.innerHTML = tds;
      body.appendChild(tr);
    });



    forms.forEach((form, index) => {

      document.getElementById(`btnMap-${index}`).addEventListener('click', () => {
        showMap(index+"")
      });

      const btnFoto = document.getElementById(`btnPhoto-${index}`);
      btnFoto.addEventListener('click', () => {
        document.getElementById('imgtest').setAttribute('src', form.photo);
        $("#exampleModal").modal('show');
      });
    });

  }


  function searchForm(){

    for(let i = document.getElementById("tableForms").rows.length; i > 0;i--)
    {
      document.getElementById("tableForms").deleteRow(i -1);
    }

    listForms();
  }

</script>

</body>

</html>